<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Share Image Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #2c2e31;
            --main-color: #f8af3c;
            --text-color: #d1d0c5;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .format-btn {
            opacity: 0.7;
            border: 2px solid transparent;
        }
        .format-btn.active {
            opacity: 1;
            border-color: #f8af3c;
            background-color: #3e4043 !important;
        }
    </style>
</head>
<body class="p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8" style="color: #f8af3c;">Share Image Generator Test</h1>
        
        <!-- Mock Results Data -->
        <div class="bg-gray-800 p-6 rounded-lg mb-6">
            <h2 class="text-xl font-bold mb-4">Test Game Results</h2>
            <div class="grid grid-cols-3 gap-4">
                <div>
                    <p class="text-sm text-gray-400">Final Score</p>
                    <p id="final-streak" class="text-2xl font-bold">15</p>
                </div>
                <div>
                    <p class="text-sm text-gray-400">Best Score</p>
                    <p id="results-best-streak" class="text-2xl font-bold text-yellow-400">23</p>
                </div>
                <div>
                    <p class="text-sm text-gray-400">Accuracy</p>
                    <p id="accuracy-stat" class="text-2xl font-bold text-green-400">85.5%</p>
                </div>
            </div>
            <p id="evaluation-result" class="mt-4 text-lg text-center" style="color: #f8af3c;">‡ªÄ‡∫à‡∫ª‡ªâ‡∫≤‡ªÅ‡∫°‡ªà‡∫ô‡∫•‡∫π‡∫Å‡∫ä‡∫≠‡∫î‡∫•‡∫≤‡∫ß 75%</p>
        </div>
        
        <!-- Share Image Section -->
        <div class="bg-gray-800/50 backdrop-blur rounded-xl p-6 shadow-2xl border border-gray-700">
            <h3 class="text-xl font-bold mb-4" style="color: #f8af3c;">‡ªÅ‡∫ö‡ªà‡∫á‡∫õ‡∫±‡∫ô‡∫ú‡∫ª‡∫ô‡∫Ç‡∫≠‡∫á‡ªÄ‡∫à‡∫ª‡ªâ‡∫≤!</h3>
            
            <!-- Canvas for shareable image -->
            <canvas id="share-canvas" class="hidden"></canvas>
            
            <!-- Preview of shareable image -->
            <div id="share-preview-container" class="mb-4 hidden">
                <img id="share-preview" class="w-full max-w-md mx-auto rounded-lg shadow-lg" alt="Share preview">
            </div>
            
            <!-- Format selector -->
            <div class="flex justify-center gap-2 mb-3">
                <button id="format-square" class="format-btn bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded-lg text-sm transition duration-300 active">
                    Square (1:1)
                </button>
                <button id="format-landscape" class="format-btn bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded-lg text-sm transition duration-300">
                    Landscape (16:9)
                </button>
            </div>
            
            <!-- Share buttons -->
            <div class="flex flex-wrap justify-center gap-3">
                <button id="generate-share-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-bold transition duration-300">
                    Generate Share Image
                </button>
                
                <button id="download-share-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-bold transition duration-300 hidden">
                    Download Image
                </button>
                
                <button id="copy-share-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-bold transition duration-300 hidden">
                    Copy Image
                </button>
            </div>
            
            <!-- Copy status message -->
            <div id="copy-status" class="mt-3 text-sm text-green-400 hidden">
                ‚úÖ Image copied to clipboard!
            </div>
        </div>
    </div>
    
    <script>
        // Share Image Generator
        let selectedFormat = 'square';
        
        const formatSquareBtn = document.getElementById('format-square');
        const formatLandscapeBtn = document.getElementById('format-landscape');
        const generateBtn = document.getElementById('generate-share-btn');
        const downloadBtn = document.getElementById('download-share-btn');
        const copyBtn = document.getElementById('copy-share-btn');
        const previewContainer = document.getElementById('share-preview-container');
        const previewImg = document.getElementById('share-preview');
        const copyStatus = document.getElementById('copy-status');
        
        // Format switching
        formatSquareBtn.addEventListener('click', () => {
            selectedFormat = 'square';
            formatSquareBtn.classList.add('active');
            formatLandscapeBtn.classList.remove('active');
        });
        
        formatLandscapeBtn.addEventListener('click', () => {
            selectedFormat = 'landscape';
            formatLandscapeBtn.classList.add('active');
            formatSquareBtn.classList.remove('active');
        });
        
        // Generate image
        generateBtn.addEventListener('click', async () => {
            const imageDataUrl = await generateShareImage(selectedFormat);
            previewImg.src = imageDataUrl;
            previewContainer.classList.remove('hidden');
            downloadBtn.classList.remove('hidden');
            
            if (navigator.clipboard && window.ClipboardItem) {
                copyBtn.classList.remove('hidden');
            }
        });
        
        // Download image
        downloadBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = `lao-typo-score-${Date.now()}.png`;
            link.href = previewImg.src;
            link.click();
        });
        
        // Copy image
        copyBtn.addEventListener('click', async () => {
            try {
                const response = await fetch(previewImg.src);
                const blob = await response.blob();
                
                if (navigator.clipboard && window.ClipboardItem) {
                    const item = new ClipboardItem({ 'image/png': blob });
                    await navigator.clipboard.write([item]);
                    
                    copyStatus.classList.remove('hidden');
                    setTimeout(() => {
                        copyStatus.classList.add('hidden');
                    }, 3000);
                }
            } catch (err) {
                console.error('Failed to copy image:', err);
                alert('Cannot copy image. Please download instead.');
            }
        });
        
        async function generateShareImage(format = 'square') {
            const canvas = document.getElementById('share-canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size based on format
            if (format === 'landscape') {
                canvas.width = 1200;
                canvas.height = 630;
            } else {
                canvas.width = 1080;
                canvas.height = 1080;
            }
            
            // Get game stats
            const finalScore = document.getElementById('final-streak').textContent;
            const bestScore = document.getElementById('results-best-streak').textContent;
            const accuracy = document.getElementById('accuracy-stat').textContent;
            const evaluation = document.getElementById('evaluation-result').textContent;
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#2c2e31');
            gradient.addColorStop(0.5, '#3e4043');
            gradient.addColorStop(1, '#2c2e31');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add decorative pattern
            ctx.strokeStyle = 'rgba(248, 175, 60, 0.1)';
            ctx.lineWidth = 2;
            for (let i = 0; i < 20; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * 60);
                ctx.lineTo(canvas.width, i * 60);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(i * 60, 0);
                ctx.lineTo(i * 60, canvas.height);
                ctx.stroke();
            }
            
            if (format === 'landscape') {
                // Landscape layout
                ctx.font = 'bold 150px Arial';
                ctx.textAlign = 'center';
                ctx.fillStyle = '#f8af3c';
                ctx.fillText('ü¶é', 125, canvas.height / 2 + 50);
                
                const contentX = 280;
                
                ctx.fillStyle = '#f8af3c';
                ctx.font = 'bold 42px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('LaoTypo', contentX, 80);
                
                ctx.fillStyle = '#d1d0c5';
                ctx.font = '24px sans-serif';
                ctx.fillText('‡ªÄ‡∫à‡∫ª‡ªâ‡∫≤‡ªÅ‡∫°‡ªà‡∫ô‡∫Ñ‡∫ª‡∫ô‡∫•‡∫≤‡∫ß‡∫à‡∫£‡∫¥‡∫á ‡∫´‡∫º‡∫∑ ‡∫•‡∫≤‡∫ß‡∫≠‡∫µ‡ªà‡∫´‡∫•‡∫µ?', contentX, 120);
                
                ctx.fillStyle = '#72b483';
                ctx.font = 'bold 32px sans-serif';
                ctx.fillText('‡∫Ç‡ªâ‡∫≠‡∫ç‡∫´‡∫º‡∫¥‡ªâ‡∫ô‡∫à‡∫ª‡∫ö‡ªÅ‡∫•‡ªâ‡∫ß! üéâ', contentX, 180);
                
                ctx.fillStyle = '#f8af3c';
                ctx.font = 'bold 28px sans-serif';
                ctx.fillText('‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫Ç‡∫≠‡∫á‡∫Ç‡ªâ‡∫≠‡∫ç:', contentX, 240);
                
                ctx.fillStyle = '#d1d0c5';
                ctx.font = '24px sans-serif';
                ctx.fillText(`Final Score: ${finalScore}`, contentX, 290);
                ctx.fillText(`Best Score: ${bestScore}`, contentX, 330);
                ctx.fillText(`Accuracy: ${accuracy}`, contentX, 370);
                
                ctx.fillStyle = '#f8af3c';
                ctx.font = 'bold 22px sans-serif';
                ctx.fillText(evaluation, contentX, 440);
                
                ctx.fillStyle = '#646669';
                ctx.font = '20px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('laotypo.com', canvas.width / 2, canvas.height - 30);
            } else {
                // Square layout
                ctx.font = 'bold 200px Arial';
                ctx.textAlign = 'center';
                ctx.fillStyle = '#f8af3c';
                ctx.fillText('ü¶é', canvas.width / 2, 250);
                
                ctx.fillStyle = '#f8af3c';
                ctx.font = 'bold 48px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('LaoTypo', canvas.width / 2, 350);
                
                ctx.fillStyle = '#d1d0c5';
                ctx.font = '32px sans-serif';
                ctx.fillText('‡ªÄ‡∫à‡∫ª‡ªâ‡∫≤‡ªÅ‡∫°‡ªà‡∫ô‡∫Ñ‡∫ª‡∫ô‡∫•‡∫≤‡∫ß‡∫à‡∫£‡∫¥‡∫á ‡∫´‡∫º‡∫∑ ‡∫•‡∫≤‡∫ß‡∫≠‡∫µ‡ªà‡∫´‡∫•‡∫µ?', canvas.width / 2, 400);
                
                ctx.fillStyle = '#72b483';
                ctx.font = 'bold 36px sans-serif';
                ctx.fillText('‡∫Ç‡ªâ‡∫≠‡∫ç‡∫´‡∫º‡∫¥‡ªâ‡∫ô‡∫à‡∫ª‡∫ö‡ªÅ‡∫•‡ªâ‡∫ß! üéâ', canvas.width / 2, 480);
                
                ctx.fillStyle = 'rgba(100, 102, 105, 0.3)';
                ctx.fillRect(140, 520, 800, 300);
                
                ctx.fillStyle = '#f8af3c';
                ctx.font = 'bold 36px sans-serif';
                ctx.textAlign = 'left';
                ctx.fillText('‡∫Ñ‡∫∞‡ªÅ‡∫ô‡∫ô‡∫Ç‡∫≠‡∫á‡∫Ç‡ªâ‡∫≠‡∫ç:', 180, 580);
                
                ctx.fillStyle = '#d1d0c5';
                ctx.font = '32px sans-serif';
                ctx.fillText(`Final Score: ${finalScore}`, 180, 640);
                ctx.fillText(`Best Score: ${bestScore}`, 180, 690);
                ctx.fillText(`Accuracy: ${accuracy}`, 180, 740);
                
                ctx.fillStyle = 'rgba(248, 175, 60, 0.2)';
                ctx.fillRect(140, 840, 800, 120);
                
                ctx.fillStyle = '#f8af3c';
                ctx.font = 'bold 28px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(evaluation, canvas.width / 2, 900);
                
                ctx.fillStyle = '#646669';
                ctx.font = '24px sans-serif';
                ctx.fillText('laotypo.com', canvas.width / 2, 1040);
            }
            
            ctx.strokeStyle = '#f8af3c';
            ctx.lineWidth = 4;
            ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);
            
            return canvas.toDataURL('image/png');
        }
    </script>
</body>
</html>