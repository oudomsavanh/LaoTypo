<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Google Sheets Setup</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #f8af3c; text-align: center; }
        .step { margin: 20px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #f8af3c; border-radius: 5px; }
        button { background: #f8af3c; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #e09d2a; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #17a2b8; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 5px; margin: 20px 0; }
        #log { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin: 20px 0; height: 200px; overflow-y: auto; font-family: monospace; font-size: 14px; }
        .code { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; padding: 15px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîí Private Google Sheets Setup</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Security Note:</strong> This method keeps your Google Sheet completely private. 
            Only your game can access it through authenticated API calls.
        </div>
        
        <div class="step">
            <h3>Step 1: Create Service Account</h3>
            <p>1. Go to <a href="https://console.cloud.google.com" target="_blank">Google Cloud Console</a></p>
            <p>2. Create a new project or select existing one</p>
            <p>3. Enable Google Sheets API</p>
            <p>4. Go to "Credentials" ‚Üí "Create Credentials" ‚Üí "Service Account"</p>
            <p>5. Download the JSON key file</p>
            <button onclick="loadCredentials()">Load Service Account Credentials</button>
            <div id="credentials-status"></div>
        </div>
        
        <div class="step">
            <h3>Step 2: Configure Your Sheet</h3>
            <p>Enter your private Google Sheet ID:</p>
            <input type="text" id="sheet-id" placeholder="Your Google Sheet ID" style="width: 100%; padding: 10px; margin: 10px 0;">
            <button onclick="testSheetAccess()">Test Sheet Access</button>
            <div id="sheet-status"></div>
        </div>
        
        <div class="step">
            <h3>Step 3: Generate Game Code</h3>
            <p>Once configured, generate the code for your game:</p>
            <button onclick="generateGameCode()">Generate Game Code</button>
            <div id="game-code"></div>
        </div>
        
        <div class="step">
            <h3>Console Log</h3>
            <div id="log"></div>
            <button onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <script>
        let serviceAccountCredentials = null;
        let sheetId = '';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        function loadCredentials() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            serviceAccountCredentials = JSON.parse(e.target.result);
                            document.getElementById('credentials-status').innerHTML = 
                                '<div class="success">‚úÖ Service Account credentials loaded successfully!</div>';
                            log('Service Account credentials loaded', 'success');
                        } catch (error) {
                            document.getElementById('credentials-status').innerHTML = 
                                '<div class="error">‚ùå Invalid JSON file</div>';
                            log('Invalid JSON file: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        async function testSheetAccess() {
            sheetId = document.getElementById('sheet-id').value.trim();
            if (!sheetId) {
                document.getElementById('sheet-status').innerHTML = 
                    '<div class="error">‚ùå Please enter a Sheet ID</div>';
                return;
            }

            if (!serviceAccountCredentials) {
                document.getElementById('sheet-status').innerHTML = 
                    '<div class="error">‚ùå Please load Service Account credentials first</div>';
                return;
            }

            try {
                document.getElementById('sheet-status').innerHTML = 
                    '<div class="info">Testing sheet access...</div>';

                // This would require server-side implementation for security
                // For now, just validate the format
                if (sheetId.length > 10) {
                    document.getElementById('sheet-status').innerHTML = 
                        '<div class="success">‚úÖ Sheet ID format looks valid. Ready to generate code!</div>';
                    log('Sheet ID validated: ' + sheetId, 'success');
                } else {
                    throw new Error('Invalid Sheet ID format');
                }
            } catch (error) {
                document.getElementById('sheet-status').innerHTML = 
                    '<div class="error">‚ùå Error: ' + error.message + '</div>';
                log('Sheet access error: ' + error.message, 'error');
            }
        }

        function generateGameCode() {
            if (!serviceAccountCredentials || !sheetId) {
                alert('Please complete steps 1 and 2 first');
                return;
            }

            const gameCode = `
// Add this to your play.html file
// Replace the loadGameContent function with this:

async function loadGameContent() {
    try {
        wordLoadingStatus.textContent = '‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÇ‡∫´‡∫º‡∫î‡∫Ñ‡∫≥‡∫™‡∫±‡∫ö‡∫à‡∫≤‡∫Å Google Sheets...';
        wordLoadingStatus.style.color = 'var(--main-color)';

        // Your private sheet configuration
        const SHEET_ID = '${sheetId}';
        const API_KEY = 'YOUR_GOOGLE_API_KEY'; // Get from Google Cloud Console
        
        // Fetch from your private sheet
        const response = await fetch(\`https://sheets.googleapis.com/v4/spreadsheets/\${SHEET_ID}/values/Sheet1!A:D?key=\${API_KEY}\`);
        
        if (!response.ok) {
            throw new Error(\`HTTP error! status: \${response.status}\`);
        }
        
        const data = await response.json();
        const rows = data.values || [];
        
        if (rows.length < 2) {
            throw new Error('No data found in sheet');
        }

        // Convert to wordPairs structure
        wordPairs = rows.slice(1).map((row, index) => ({
            context: row[0] || '',
            correct: row[1] || '',
            incorrect: row[2] || '',
            difficulty: parseInt(row[3]) || 1,
            order: index + 1
        })).filter(w => w.context && w.correct && w.incorrect);

        if (wordPairs.length === 0) {
            throw new Error('No valid words found');
        }

        console.log('Loaded words from private Google Sheet:', wordPairs.length);

        wordLoadingStatus.textContent = \`‡ªÇ‡∫´‡∫º‡∫î‡∫™‡∫≥‡ªÄ‡∫•‡∫±‡∫î! ‡∫°‡∫µ \${wordPairs.length} ‡∫Ñ‡∫≥‡∫™‡∫±‡∫ö\`;
        wordLoadingStatus.style.color = 'var(--correct-color)';

        setTimeout(() => {
            wordLoadingStatus.style.display = 'none';
            retryLoadingContainer.classList.add('hidden');
        }, 1500);

        // Shuffle words
        wordPairs = shuffleArray(wordPairs);

        // Initialize shuffled words for each difficulty
        shuffledWordsByDifficulty[1] = shuffleArray(wordPairs.filter(word => word.difficulty === 1));
        shuffledWordsByDifficulty[2] = shuffleArray(wordPairs.filter(word => word.difficulty === 2));
        shuffledWordsByDifficulty[3] = shuffleArray(wordPairs.filter(word => word.difficulty === 3));

    } catch (error) {
        console.error('Error loading game content from Google Sheets:', error);
        wordLoadingStatus.textContent = '‡ªÇ‡∫´‡∫º‡∫î‡∫ú‡∫¥‡∫î‡∫û‡∫≤‡∫î! ‡∫Å‡∫∞‡∫•‡∫∏‡∫ô‡∫≤‡∫Å‡∫ß‡∫î‡∫™‡∫≠‡∫ö‡∫Å‡∫≤‡∫ô‡ªÄ‡∫ä‡∫∑‡ªà‡∫≠‡∫°‡∫ï‡ªç‡ªà‡∫≠‡∫¥‡∫ô‡ªÄ‡∫ï‡∫µ‡ªÄ‡∫ô‡∫±‡∫î';
        wordLoadingStatus.style.color = 'var(--error-color)';
        retryLoadingContainer.classList.remove('hidden');
        wordPairs = [];
        console.log('No words loaded - Google Sheets connection required');
    }
}

// Instructions:
// 1. Get your Google API key from: https://console.cloud.google.com/apis/credentials
// 2. Replace 'YOUR_GOOGLE_API_KEY' with your actual API key
// 3. Make sure your Google Sheet is shared with your service account email
// 4. Your sheet should have columns: Context, Correct, Incorrect, Difficulty
            `;

            document.getElementById('game-code').innerHTML = 
                '<div class="code">' + gameCode.replace(/\n/g, '<br>') + '</div>';
            
            log('Game code generated successfully', 'success');
        }

        // Auto-load on page load
        window.addEventListener('load', () => {
            log('Private Google Sheets Setup loaded', 'info');
        });
    </script>
</body>
</html>